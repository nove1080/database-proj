<%@ page import="java.util.HashMap"%>
<%@ page import="java.util.Map"%>
<%@ page import="java.util.List" %>
<%@ page import="java.util.Iterator"%>
<%@ page import="java.sql.Date"%>
<%@ page import="utils.BoardPage" %>
<%@ page import="dto.ReservationDTO" %>
<%@ page import="dao.ReservationDAO" %>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ include file="../process/isLoggedIn.jsp" %>
<%
ReservationDAO dao = new ReservationDAO(application);

String userMid = session.getAttribute("userMid").toString();
String userMname = session.getAttribute("userMname").toString();

// 현재 페이지
int currentPage = 1;
String tempPageNum = request.getParameter("page");
if(tempPageNum != null && !tempPageNum.trim().equals("")) 
	currentPage = Integer.parseInt(tempPageNum);

// 페이지, 블록 정보
Map<String, Object> countMap = new HashMap<String, Object>();
countMap.put("mid", userMid);
	
int pageSize = Integer.parseInt(application.getInitParameter("POSTS_PER_PAGE"));
int blockSize = Integer.parseInt(application.getInitParameter("PAGES_PER_BLOCK"));
int totalPost = dao.getCount(countMap);
int totalPage = (int)Math.ceil(totalPost / (double)pageSize);

// 페이지 별 가져올 예약 개수
int startPost = (currentPage - 1) * pageSize + 1;
int endPost = currentPage * pageSize;

// 메서드 호출을 위한 매개변수 준비
Map<String, Object> rangeMap = new HashMap<String, Object>();
rangeMap.put("mid", userMid);
rangeMap.put("startPost", Integer.valueOf(startPost));
rangeMap.put("endPost", Integer.valueOf(endPost));

// 예약 정보 불러오기(페이징)
List<ReservationDTO> reservationList = dao.getReservationListPage(rangeMap);

dao.close();
%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>풋살장 예약 시스템 - 예약 조회</title>
<link rel="stylesheet" href="../css/style.css"/>
<link rel="stylesheet" href="../css/title.css"/>
<link rel="stylesheet" href="../css/support.css"/>
<link rel="stylesheet" href="../css/topbar.css"/>
<link rel="stylesheet" href="../css/paging.css"/>
<link rel="stylesheet" href="../css/history.css" />
</head>
<body>
	<header>
		<jsp:include page="../inc/title.jsp"/>
		<jsp:include page="../menubar/topbar.jsp"/>
	</header>
	<div id="wrap">
		<h2>예약 조회</h2>
		<jsp:include page="../inc/reservationList.jsp"/>
	</div>
	<footer class="footer">	
		<jsp:include page="../inc/support.jsp"/>
	</footer>
</body>
</html>